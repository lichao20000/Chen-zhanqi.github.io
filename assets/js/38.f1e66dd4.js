(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{530:function(t,a,s){"use strict";s.r(a);var r=s(4),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",[t._v("解决某考研查询某小程序jwt权限认证与采集")])]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("日常采集数据时, 有很多需要登录才能获取的数据, 不能解决权限认证这个问题, 就无法获取到想要采集的数据, 目下流行的认证机制有session, token 与 JWT, 最近写爬虫遇到这个问题, 记录下解决方法")]),t._v(" "),s("h2",{attrs:{id:"爬虫需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#爬虫需求"}},[t._v("#")]),t._v(" 爬虫需求")]),t._v(" "),s("p",[t._v("如图: 获取每个高校详情页的上 中 下 三部分类容")]),t._v(" "),s("h3",{attrs:{id:"列表页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列表页"}},[t._v("#")]),t._v(" 列表页")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216182520.png",alt:"列表页"}})]),t._v(" "),s("h3",{attrs:{id:"详情页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#详情页"}},[t._v("#")]),t._v(" 详情页")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216182657.png",alt:"详情页"}})]),t._v(" "),s("h2",{attrs:{id:"项目逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目逻辑"}},[t._v("#")]),t._v(" 项目逻辑")]),t._v(" "),s("ol",[s("li",[t._v("使用Fiddler抓包, 查看响应数据结构")]),t._v(" "),s("li",[t._v("对应字段创建数据库表")]),t._v(" "),s("li",[t._v("编写爬虫代码")]),t._v(" "),s("li",[t._v("解决权限认证问题")]),t._v(" "),s("li",[t._v("解析数据, 保存数据")])]),t._v(" "),s("h3",{attrs:{id:"抓包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抓包"}},[t._v("#")]),t._v(" 抓包")]),t._v(" "),s("p",[s("strong",[t._v("认证")]),t._v("\n第一次进小程序是, 一般都会弹出微信授权, 这个也就是服务后端用来登录的接口, 抓包发现返回登录成功的数据, token结构是无疑问后端采集的是 JWT 认证机制, 有了登录接口, 采集就好办了, 而JWT的使用在请求时Headers中带上Authorization参数\n"),s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216184049.png",alt:"登录"}})]),t._v(" "),s("p",[s("strong",[t._v("列表页")]),t._v(" "),s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216185633.png",alt:"jwt请求列表页"}}),t._v(" "),s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216185755.png",alt:"不带JWT请求列表页"}})]),t._v(" "),s("p",[s("strong",[t._v("详情页")]),t._v(" "),s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216190020.png",alt:"jwt详情页"}}),t._v(" "),s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216190149.png",alt:"携带无效令牌访问"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("总结")]),t._v(" "),s("p",[t._v("在请求接口时, 全程携带认证令牌且保证令牌有效, 否则无法获取数据")])]),t._v(" "),s("h3",{attrs:{id:"建表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建表"}},[t._v("#")]),t._v(" 建表")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216190413.png",alt:"建表"}})]),t._v(" "),s("h3",{attrs:{id:"爬虫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#爬虫"}},[t._v("#")]),t._v(" 爬虫")]),t._v(" "),s("p",[t._v("使用scrapy框架开发")]),t._v(" "),s("p",[s("strong",[t._v("起始函数")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216191418.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("详情页函数")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216191638.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("写入数据库")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216191841.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("下载中间件")])]),t._v(" "),s("p",[t._v("这步就是实现携带令牌访问的代码, 需要在配置开启此中间件")]),t._v(" "),s("p",[t._v("加了随机请求头功能, 代理ip也可在此中间件加入")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216191939.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("配置文件")])]),t._v(" "),s("p",[t._v("配置数据库信息")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216192131.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[t._v("#")]),t._v(" 结果")]),t._v(" "),s("h3",{attrs:{id:"输出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#输出"}},[t._v("#")]),t._v(" 输出")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216192458.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据"}},[t._v("#")]),t._v(" 数据")]),t._v(" "),s("p",[t._v("20分钟采集了1万条数据\n"),s("img",{attrs:{src:"https://gitee.com/chen-zq/bgimages/raw/master/img/20201216192710.png",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);